!function(){"use strict";const e="freewheel",t="playing",s="external",i=s,n="time",r="__jwpseg__",o="instream",a="article",l={[[o]]:1,[["banner"]]:2,[[a]]:3,[["feed"]]:4,[["floating"]]:5,[["interstitial"]]:5,[["slider"]]:5},d="adError",h="adBreakStart",c="adBreakEnd",u="adSkipped",p="jw-flag-ads-vpaid",g="jw-flag-ads-freewheel",m="jw-freewheel-before-impression",f=(e,t)=>({begin:e._offSet,text:t,cueType:"ads",adId:e.adBreakId});class y{constructor(e,t,s,i){this.client=i,this.player=e,this.pluginConfig=t,this.div=s,this.utils=this.player.utils,this.playerConfig=this.player.getConfig(),this.playlistItemManager=null,this.playerKey=this.playerConfig.key,this.casting=!1,this.player.pauseAd=this.pauseAd.bind(this),this.player.skipAd=this.skipAd.bind(this),this.player.skipAdBreak=this.skipAdBreak.bind(this),this.destroyAdsManager=this.destroyAdsManager.bind(this),this.handleDependencyError=this.handleDependencyError.bind(this),this.sendCues=this.sendCues.bind(this)}lateInitAfterReady(){this.onReady();const e=this.player.getPlaylistItem();e&&this.onPlaylistItemCallback({item:e,index:this.player.getPlaylistIndex()})}onReady(){throw new Error("Not implemented.")}onPlaylistItemCallback(){throw new Error("Not implemented.")}destroyAdsManager(){this.playlistItemManager&&(this.playlistItemManager.destroy(),this.playlistItemManager=null)}handleDependencyError(t,s){this.destroyAdsManager(),this.player.off(null,null,this),this.client===e&&(this.player.playAd=this.utils.noop),this.player.trigger(d,{id:"-1",client:this.client,message:t,code:900,adErrorCode:s,tag:""})}pauseAd(e,t=null){this.playlistItemManager&&(e?this.playlistItemManager.pause(t||{}):this.playlistItemManager.resume(t||{}))}skipAd(){var e;null!=this&&null!=(e=this.playlistItemManager)&&e.skipAd&&this.playlistItemManager.skipAd()}skipAdBreak(){var e;null!=this&&null!=(e=this.playlistItemManager)&&e.skipAdBreak&&this.playlistItemManager.skipAdBreak()}sendCues(e,t){const s=e.getMidRolls(),i=[];e.preRoll&&i.push(f(e.preRoll,t)),s.length&&s.forEach((e=>{"nonlinear"!==e._type&&i.push(f(e,t))})),e.postRoll&&i.push(f(e.postRoll,t)),this.player.addCues(i)}resetCues(){const e=this.player.getCues().filter((e=>"ads"!==e.cueType));this.player.setCues(e)}}const _=function(e,t,s,i){if(0!==i.indexOf(e))return!1;const n=parseFloat(i.slice(e.length));return!(n<t||n>s)&&n},E=_.bind(null,"800000",10,90),A=_.bind(null,"900000",10,90),v=_.bind(null,"JWIAB",1,999),I=_.bind(null,"120321",10,90),w=_.bind(null,"120241",10,90),C=_.bind(null,"15010",1,698),T=["15020012","15020023","15020034"],b=/^[^:/?#]+:?\/\/[^/?#]+/,P=e=>e?new URL(e).hostname:"",S=(e,t=document.location.search)=>{if(e)return new URLSearchParams(t).getAll(e)},L=/^(https?:\/\/).*.(?:ampproject.org|bing-amp.com)\/(?:.\/)*(.*)\/amp.*$/,O=function(){if(!((e,t)=>{if(e)return new URLSearchParams(e).has(t)})(document.location.search,"isAMP"))return;const e=S("consentValue").join(),t=S("consentGdpr").join();return e||t?{gdprApplies:t,consentData:e}:void 0},k=Date.now||function(){return(new Date).getTime()},M=e=>{const t=(e=>{let t=window;for(;t;){try{if(t.frames[e])break}catch(e){}t=t===window.top?null:t.parent}return t})(`${e}Locator`);return null!==t&&function(s,i,n,r){const o=k(),a=t=>{let s=t?t.data:{};if("string"==typeof s)try{s=JSON.parse(s)}catch(e){s={}}const i=`${e}Return`;s[i]&&s[i].callId===o&&(removeEventListener("message",a),n(s[i].returnValue,s[i].success))};window.addEventListener("message",a,!1);const l={[[`${e}Call`]]:{command:s,callId:o,parameter:r,[[void 0!==r?"version":"parameter"]]:i}};t.postMessage(JSON.stringify(l),"*")}};let R=null,j={gdprApplies:!0,consentData:""};const x=function(e){const t=e.advertising;if(null!=t&&t.placement){const e=t.placement.toLowerCase();if(l[e])return l[e]}return l[null!=t&&t.outstream?a:o]},D=function(){const e=(t=document.referrer)&&null!==t.match(b)?function(e){const t=e.match(L);return t&&t.length>1?`${t[1]}${t[2]}`:e}(document.referrer):"";var t;if(window.top!==window.self){try{return{url:window.top.location.href,domain:window.top.document.domain,referrer:e}}catch(e){}return{url:e,domain:P(e),referrer:""}}return{url:document.location.href,domain:document.domain,referrer:e}},N=function(e,t,s=!0){if("start"===e||"0%"===e||s&&!e&&0!==e)return"pre";if("end"===e||"100%"===e)return"post";if("string"==typeof e&&("pre"===e||"post"===e||e.indexOf("%")>=0))return e;const i=t.seconds(e);return"number"==typeof i&&!isNaN(i)&&i},V=function(e,t){const s=e.getPlugin("inference"),i=t.jwpseg_client_side,n=t.jwpseg||[];let r;if(!i||!i.length||!s)return n;try{r=s.predict(i,t)}catch(e){return t.jwpseg||[]}return[...Object.keys(r).filter((e=>r[e])),...n.filter((e=>-1===i.indexOf(e)))]},B=function(e){const t=[],s=[],i=[],n=[];let r=Boolean(e.some((e=>/^1/.test(String(e)))));for(let n of e){"string"!=typeof n&&(n=String(n));const e=E(n);if(e){t.push(e);continue}const o=I(n);if(o){t.push(o);continue}const a=A(n);if(a){s.push(a);continue}const l=w(n);if(l){s.push(l);continue}const d=v(n);if(d){i.push(d);continue}const h=C(n);h?i.push(h):T.includes(String(n))?r=!1:"JWBRSAFE"!==n||(r=!0)}if(r&&n.push(1),t.length||s.length||i.length||n.length){const e={hb_jwvb:t,hb_jwcr:s,hb_jwiab:i,hb_jwbs:n};return Object.keys(e).forEach((t=>{e[t]=[...new Set(e[t])]})),e}return null},U=e=>{if("true"===e)return!0;if("false"===e)return!1;const t=parseFloat(e);return isNaN(t)?e:t},$=(e,t=!1)=>{const s=t?0===e.getPosition()&&"idle"===e.getState():0===e.getPosition();return e.isBeforePlay()||s?"pre":e.isBeforeComplete()||e.getPosition()===e.getDuration()?"post":"mid"};var q=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)};class F{constructor(e,t,s){this.config=e,this.setOptions(s),this.setLocalizationOptions(t)}setLocalizationOptions(e){for(const t in e)t&&"string"==typeof t&&(this[t]=e[t])}setOptions(e,t=!1){for(const s in e)if(q(e,s)){let i=t?this.config[s]||this.config[s.toLowerCase()]:this.config[s];const n=e[s],r=typeof n;if(void 0!==i){if("boolean"!==r&&"number"!==r||(i=U(i)),typeof i!==r)throw new Error(`invalid parameter: ${s} should be a ${r}`);this[s]=i}else this[s]=n}}}class Y extends F{constructor(e,t,s){var i,n,r,o;const a=t.localization.advertising,{admessage:l,podmessage:d,cuetext:h,loadingAd:c,skipmessage:u,skiptext:p}=a;super(e,{admessage:l,podmessage:d,cuetext:h,loadingAd:c,skipmessage:u,skiptext:p},{debug:!1,admessagedynamickey:/(\b)xx(s?\b)/g,loadVideoTimeout:15e3,requestTimeout:15e3,adBlockTimeout:4e3}),this.admessagedynamic=this.admessage,this.fwassetid=s.fwassetid||t.fwassetid,this.duration=s.duration||t.duration||0,this.adschedule=s.adschedule||null;const g=s.freewheel||{},m=this.config.freewheel||{};this.profileid=g.profileid||m.profileid,this.sectionid=g.sectionid||m.sectionid,this.networkid=g.networkid||m.networkid,this.serverid=g.serverid||m.serverid,this.afid=g.afid||m.afid,this.sfid=g.sfid||m.sfid,this.vcid=g.vcid||m.vcid,this.capabilities={flag:{},metr:{}},null!=g&&null!=(i=g.capabilities)&&i.flag?this.capabilities.flag=g.capabilities.flag:null!=m&&null!=(n=m.capabilities)&&n.flag&&(this.capabilities.flag=m.capabilities.flag),null!=g&&null!=(r=g.capabilities)&&r.metr?this.capabilities.metr=g.capabilities.metr:null!=m&&null!=(o=m.capabilities)&&o.metr&&(this.capabilities.metr=m.capabilities.metr),this.custom=g.custom||m.custom||{}}setOptions(e){return super.setOptions(e,!0)}getSchedule(){const e=this.config;return this.adschedule||e.tag||e.schedule||e.ad}getAdRules(){const e=this.config.rules||{},t=parseInt(e.frequency,10);return{startOn:e.startOn||1,frequency:isNaN(t)?1:t}}}const K={};const G="6.43.0",z=`http://adm.fwmrm.net/libs/adm/${G}/AdManager.js`,W=`https://mssl.fwmrm.net/libs/adm/${G}/AdManager.js`;let H=null;function J(e,t=null){var s,i;if(!H&&null!=(s=window)&&null!=(i=s.tv)&&i.freewheel&&(H=Promise.resolve()),H)return H;const{protocol:n}=document.location;return H=function(e,t){if(K[t])return K[t];"file:"===document.location.protocol&&0===t.indexOf("//")&&(t=`https:${t}`);const s=new(0,e.scriptloader)(t);return K[t]=s.load(),K[t]}(e,t||("file:"===n||"https:"===n?W:z)),H}const Q={},X={},Z=(e,t,s)=>{const i=X[t];return i||(X[t]=((e,t)=>{const s=Q[t];return s||(Q[t]=new Promise(((s,i)=>{const n=new e.key(t);if("unlimited"===n.edition())return i();const r=["//","entitlements.jwplayer.com","/",n.token(),".json"];"file:"===window.location.protocol&&r.unshift("https:"),e.ajax(r.join(""),(function(e){const t=null==e?void 0:e.response;t?s(t):i()}),(function(){i()}),{timeout:1e4,responseType:"json"})})))})(e,t).catch((()=>({}))).then((e=>{let t,i;if(!0===s.outstream?(t=!1!==e.canPlayOutstreamAds,i="Outstream Ad Limit Reached"):(t=!1!==e.canPlayAds,i="Ad Limit Reached"),!1===t)throw new Error(i);return{message:"Can Play Ads"}})))};class ee{constructor(e,t){e.extend(this,t),this.isMuted=!1,this.vol=0,this.freewheelProxy=null}setProxy(e){this.freewheelProxy=e,this.mute(this.isMuted)}attachMedia(){}detachMedia(){}mute(e){this.isMuted=e,this.freewheelProxy&&this.freewheelProxy.setAdVolume(this.isMuted?0:this.vol)}volume(e){this.vol=e/100,this.freewheelProxy&&this.freewheelProxy.setAdVolume(this.vol)}setFullscreen(e){if(this.video){if(e)try{const e=this.video.webkitEnterFullscreen;e&&e.apply(this.video)}catch(e){return!1}else{const e=this.video.webkitExitFullscreen;e&&e.apply(this.video)}return Boolean(e)}}}var te="2.2.17",se=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)};const ie=/^((https?:)?\/\/)?(secure)?pubads\.g\.doubleclick\.net\/gampad\/ads\?[\S]*$/,ne=function(e,t,s){return e.replace(t,s)},re=function(e,t){const s=Math.pow(10,t);return Math.round(e*s)/s},oe=function(t,s,i,n,o,a={}){var l,d,h,c,u,p,g;if(!t)return t;const m=function(e,t){const s=e.getConfig(),i=e.getPlaylistItem()===t,n={playerHeight:e.getHeight()||s.height||"",playerWidth:e.getWidth()||s.width||"",itemDuration:i&&re(e.getDuration(),3)||"",integerDuration:i&&re(t.duration,0)||"",item:t,jwpseg:V(e,t),placement:x(s),userAgent:navigator.userAgent},r=s.advertising?s.advertising.ampMacros:{};return Object.assign(n,r)}(s,i),f=D();let y=null;null!=i&&i.jwpseg&&(y=B(i.jwpseg));const _={viewability:(null==(l=y)||null==(d=l.hb_jwvb)?void 0:d.map((e=>encodeURIComponent(e))).join(","))||"",completion:(null==(h=y)||null==(c=h.hb_jwcr)?void 0:c.map((e=>encodeURIComponent(e))).join(","))||"",brandSafety:1===(null==(u=y)?void 0:u.hb_jwbs[0])?encodeURIComponent("Yes"):encodeURIComponent("No"),contextual:(null==(p=y)||null==(g=p.hb_jwiab)?void 0:g.map((e=>encodeURIComponent(e))).join(","))||""};-1!==t.indexOf(r)&&(a.jwpseg=m.jwpseg),t=ne(t,"__random-number__",Math.random()*Math.pow(10,18)),t=ne(t,"__timestamp__",(new Date).getTime()),t=ne(t,"__page-url__",encodeURIComponent(m.pageUrl||f.url)),t=ne(t,"__referrer__",encodeURIComponent(m.referrer||f.referrer)),t=ne(t,"__player-height__",m.playerHeight),t=ne(t,"__player-width__",m.playerWidth),t=ne(t,"__item-duration__",m.itemDuration),t=ne(t,"__integer-duration__",m.integerDuration),t=ne(t,r,m.jwpseg),t=ne(t,"__domain__",encodeURIComponent(m.domain||f.domain)),t=ne(t,"__placement__",m.placement),t=ne(t,"__device-ua__",encodeURIComponent(m.userAgent)),t=ne(t,"__jw-viewability__",_.viewability),t=ne(t,"__jw-completion__",_.completion),t=ne(t,"__jw-brand-safety__",_.brandSafety),t=ne(t,"__jw-contextual__",_.contextual),t=o.companion?ne(t,"__companion-div__",o.companion.id):ne(t,"__companion-div__","");const E=Object.keys(m).filter((e=>-1!==e.indexOf("item"))),A=E.map((e=>{const t=e.match(/item([\w]+?)(List)?$/);let s;return t&&(s=t[1].toLowerCase()),s}));let v=null;const I=/__item-([\w-]+?)(-list)?__/g,w=t;for(;null!==(v=I.exec(w));){const e=v[0],s=v[1],n=E[A.indexOf(s)];let r="";if(se(i,s)&&"string"==typeof i[s]||n){r=n?m[n]:i[s];const e=!1===o.truncateMacros?4096:1e3;r.length>e&&(r=r.substring(0,e));const t=v[2]?",":null;r=r.split(t).map(encodeURIComponent)}t=ne(t,e,r)}if(n===e)return t;if("vast"===n){const e=s.getConfig().autostart?1:0,i=s.getMute()?1:0;t=function(e,t,s){return ie.test(e)&&(e=`${e}&vpa=${t}&vpmute=${s}`),e}(t,e,i)}if("googima"===n&&i.title&&-1===t.indexOf("vid_t=")){const e=i.title.substring(0,100).replace(/[^\x00-\x7F]/g,"");t+=`${function(e){return-1!==e.indexOf("?")?"&":"?"}(t)}vid_t=${encodeURIComponent(e)}`}return-1!==t.indexOf("__gdpr__")||-1!==t.indexOf("__gdpr_consent__")||-1!==t.indexOf("__addtl_consent__")?function(e=1e3){return null===R&&(R=new Promise((e=>{const t=window.__tcfapi||M("__tcfapi");if(t)return t("getTCData",2,((t,s)=>{e(!1!==s?{gdprApplies:t.gdprApplies,consentData:t.tcString,addtlConsent:t.addtlConsent}:null)}));const s=window.__cmp||M("__cmp");if(s)return s("getConsentData",null,((t,s)=>{e(!1!==s?{gdprApplies:t.gdprApplies||t.isUserInEu,consentData:t.consentData}:null)}));const i=O();return e(i||{gdprApplies:!1,consentData:""})})).then((e=>(e&&(j=e),j)))),Promise.race([R,new Promise((t=>{setTimeout(t,e,j)}))])}().then((({gdprApplies:e,consentData:s,addtlConsent:i})=>(t=ne(t,"__gdpr__",e?1:0),t=ne(t,"__addtl_consent__",i||""),ne(t,"__gdpr_consent__",s||"")))).catch((()=>t)):Promise.resolve(t)},ae=(e,t)=>{let s=N(e,t,!1);return s||(s="pre"),"number"==typeof s&&(s=(e=>{const t=parseInt(e,10);let s=Math.floor(t)%1e3,i=Math.floor(t/1e3)%60,n=Math.floor(t/6e4)%60,r=Math.floor(t/36e5)%24;return r=r<10?`0${r}`:r,n=n<10?`0${n}`:n,i=i<10?`0${i}`:i,s=`000${s}`.slice(-3),`${r}:${n}:${i}.${s}`})(1e3*s)),s};class le{constructor(e,t){this.player=e,this.options=t}getTagMap(t){const s=this.player,i=s.utils,n={},r=s.getPlaylistItem(s.getPlaylistItemIndex);return i.foreach(((e,t,s)=>{const i={};return t.foreach(e,(function(e,s){const n={};let r=s;s.ad&&(r=s.ad),n.offset=ae(r.offset||r.position||s.offset||"",t),n.tag=r.tag,r.customadunitname&&(n.customadunitname=r.customadunitname),n.type=r.type||s.type||"linear,nonlinear",void 0!==r.skipoffset&&(n.skipoffset=r.skipoffset),i[e]=n})),i})(t,i,s._),((t,o)=>{let a=N(o.offset,i,!1);if(s._.isString(a)&&(a=parseFloat(a.replace("pre","0").replace("post","-1"))),s._.isNumber(a)){const t={tagName:oe(o.tag,s,r,e,this.options),type:o.type};void 0!==o.skipoffset&&(t.skipoffset=o.skipoffset),o.customadunitname&&(t.customAdUnitName=o.customadunitname),n[a]=t}})),n}}var de=function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");return Object.prototype.hasOwnProperty.call(Object(e),t)};const he={};class ce{constructor(e,t,s,i){this.responsePromise=null,this.streamType=s,this.sdk=i,this.adsManager=new this.sdk.AdManager,this.adsManager.setNetwork(t.networkid),this.adsManager.setServer(t.serverid),this.options=t||{},this.version=e,this.schedule=null,this.tagMap={},this._fwassetid=null,this._fwduration=0}open(e,t){const{sdk:s}=this,i=this.options;if(this.currentAdContext)throw new Error("Request already made");const n=i.getSchedule();if(!n)return this.responsePromise=Promise.reject(),this.responsePromise;if(this.currentAdContext=this.adsManager.newContext(),this.setContextSettings(this.currentAdContext),this._fwassetid=i.fwassetid,this._fwduration=i.duration,this.schedule=n,this.responsePromise=new Promise(((e,t)=>{this.currentAdContext.addEventListener(s.EVENT_REQUEST_COMPLETE,e),this.currentAdContext.addEventListener(s.EVENT_ERROR,t)})),"string"==typeof n)this.currentAdContext.addTemporalSlot(n,s.ADUNIT_PREROLL,0);else{const r=new le(e,t),o=this.tagMap=r.getTagMap(n),a=Object.keys(o);for(let e=0;e<a.length;e++){let t=parseFloat(a[e]);const n=o[t].tagName,r=o[t].customAdUnitName;let l=null;if("overlay"===o[t].type){if(-1===t)continue;l=s.ADUNIT_OVERLAY}if(!l)switch(t){case 0:l=r||s.ADUNIT_PREROLL;break;case-1:l=r||s.ADUNIT_POSTROLL,t=i.duration||1;break;default:l=r||s.ADUNIT_MIDROLL}this.currentAdContext.addTemporalSlot(n,l,t)}}return this.setCustomKeys(this.currentAdContext),this.responsePromise}setContextSettings(e){const{options:t}=this;e.setProfile(t.profileid),he[t.sectionid]||(he[t.sectionid]=Math.floor(2147483648*Math.random()));const s=he[t.sectionid],i=t.sfid||null;e.setSiteSection(t.sectionid,null,s,null,i);const n=t.vcid||null;e.setVisitor(n,null)}setCustomKeys(e){const{custom:t}=this.options;let s=!1;for(const i in t)if(de(t,i)){let n=t[i];n&&"string"!=typeof n&&(n=n.toString()),s||(e._adRequest._keyValues.push(""),s=!0),"_fw_gdpr"===i?this.adsManager._fwGDPR=t[i]:"_fw_gdpr_consent"===i?this.adsManager._fwGDPRConsent=n:e.addKeyValue(i,n)}}requestAds(e){const t=e.getContainer(),s=t.querySelector(".jw-wrapper");s.id=`${t.id}-jw-wrapper`,this.currentAdContext.registerVideoDisplayBase(s.id),this.setRequestSettings(this.currentAdContext,e),this.currentAdContext.submitRequest()}setRequestSettings(e,t){const{sdk:s}=this,i=t.getConfig();let n=s.VIDEO_ASSET_AUTO_PLAY_TYPE_NONE;i.autostart&&(n=i.playOnViewable?s.VIDEO_ASSET_AUTO_PLAY_TYPE_ATTENDED:s.VIDEO_ASSET_AUTO_PLAY_TYPE_UNATTENDED);const r=Math.floor(2147483648*Math.random()),o=this.options.afid||null;"LIVE"===i.streamType||this.streamType&&"LIVE"===this.streamType.toUpperCase()?(e.setVideoAsset(this._fwassetid,this._fwduration,null,null,n,r,null,o,s.VIDEO_ASSET_DURATION_TYPE_VARIABLE),e.setRequestMode(s.REQUEST_MODE_LIVE)):e.setVideoAsset(this._fwassetid,this._fwduration,null,null,n,r,null,o);const a=Math.floor(i.bandwidthEstimate/1e3);e.setParameter(s.PARAMETER_DESIRED_BITRATE,a,s.PARAMETER_LEVEL_OVERRIDE),e.setParameter(s.PARAMETER_EXTENSION_CONTENT_VIDEO_ENABLED,!1,s.PARAMETER_LEVEL_GLOBAL),this.options.capabilities&&this.setCapabilities(e)}setCapabilities(e){const{options:t,sdk:s}=this,i=t.capabilities;if(i.flag)for(const t in i.flag)if(null!=t&&t.length){const n="on"===i.flag[t]?s.CAPABILITY_STATUS_ON:s.CAPABILITY_STATUS_OFF,r=s[t]?s[t]:t;e.setCapability(r,n)}i.metr}destroy(){this.responsePromise=null,this.adsManager.dispose()}}const ue=(t,s,i,n=null)=>{const r={[i.TIME_POSITION_CLASS_PREROLL]:"pre",[i.TIME_POSITION_CLASS_MIDROLL]:"mid",[i.TIME_POSITION_CLASS_POSTROLL]:"post",[i.TIME_POSITION_CLASS_OVERLAY]:"overlay",[i.TIME_POSITION_CLASS_DISPLAY]:"display"};return{type:t,client:e,adposition:r[n]||$(s),viewable:s.getViewable()}};let pe=null,ge=!1;const me=e=>{e.stopPropagation()};class fe{constructor(e,t,s,i,n,r){s.utils.extend(this,s.Events),this.item=e,this.options=t,this.streamType=n,this.sdk=r,this.player=s,this.playerContainer=s.getContainer(),this.utils=s.utils,this.style=s.utils.style,this.environment=s.getEnvironment(),this.instreamProvider=i,this.initAdsManagerPromise=null,this.adsLoadedPromise=null,this.blockingInstreamPlayer=null,this.video=null,this.timeoutAdStart=-1,this.timeoutAdLoad=-1,this.adBlockTimeout=-1,this.progressIntervalId=-1,this.nonlinearContainerId=null,this.slots={prerolls:[],midrolls:[],postrolls:[]},this.playedMidrollIndex=[],this.mobileEventListeners={play:()=>this.adResume({reason:this.reason||"interaction"}),beginFullscreen:e=>this.startFullscreen(e),endFullscreen:e=>this.endFullscreen(e)},this.reason=null,this.playerEventListeners={"idle play pause beforeComplete":this.setVideoState},this.addPlayerListeners(),this._qoe=new s.utils.Timer,this.adStarted=this.adStarted.bind(this),this.adSlotComplete=this.adSlotComplete.bind(this),this.allAdEvent=this.allAdEvent.bind(this)}init(){this.initAdsManagerPromise=J(this.utils).then((()=>this.destroyed()?null:(this.sdk||(this.sdk=tv.freewheel.SDK),this.adsLoaderManager=new ce(this.player.version,this.options,this.streamType,this.sdk),this.player.trigger("adManager",{adManager:this.adsLoaderManager.adsManager}),this.player.trigger("adsManager",{adsManager:this.adsLoaderManager.adsManager}),this.adsLoaderManager))).catch((e=>this.asyncError(e))),this.adsLoadedPromise=this.initAdsManagerPromise.then((()=>this.adsLoaderManager.open(this.player,this.options))).then((t=>{if(this.destroyed())return null;const{sdk:s}=this;if(t.success){this.trigger("adRequest",{client:e,networkid:t.response.networkId});const i=this.adsLoaderManager.currentAdContext;this.instreamProvider.setProxy(i);const n=i.getTemporalSlots(),r=[];for(let e=0;e<n.length;e++){const t=n[e];switch(t.getTimePositionClass()){case s.TIME_POSITION_CLASS_PREROLL:this.slots.prerolls.push(t);break;case s.TIME_POSITION_CLASS_OVERLAY:this.slots.midrolls.push(t);break;case s.TIME_POSITION_CLASS_MIDROLL:this.slots.midrolls.push(t),r.push({begin:t.getTimePosition(),text:this.options.cuetext,cueType:"ads",adId:t.getCustomId()?t.getCustomId():null});break;case s.TIME_POSITION_CLASS_POSTROLL:this.slots.postrolls.push(t),r.push({begin:"post",text:this.options.cuetext,cueType:"ads",adId:t.getCustomId()?t.getCustomId():null})}}this.player.addCues(r),this.registerEvents(i),i.setParameter(s.PARAMETER_RENDERER_VIDEO_DISPLAY_CONTROLS_WHEN_PAUSE,!1,s.PARAMETER_LEVEL_GLOBAL)}else this.asyncError(t);return this.slots.prerolls.length&&this.utils.addClass(this.playerContainer,g),t})).catch((e=>this.asyncError(e)))}registerEvents(e){const{sdk:t}=this;e.addEventListener(t.EVENT_SLOT_STARTED,this.adStarted),e.addEventListener(t.EVENT_SLOT_ENDED,this.adSlotComplete),e.addEventListener(t.EVENT_AD,this.allAdEvent)}startFullscreen(e){this.sendFullscreenEvent(e,!0)}endFullscreen(e){this.sendFullscreenEvent(e,!1)}sendFullscreenEvent(e,t){this.blockingInstreamPlayer&&this.blockingInstreamPlayer.trigger("fullscreenchange",{target:e.target,jwstate:t})}adErrorEventObject(t){const{sdk:s}=this;if(60003===t.adErrorCode)return t;const i=t.adInstance,n=tv?t[s.INFO_KEY_ERROR_INFO]:"FreeWheel SDK unavailable";return{id:i?i.getAdId():void 0,client:e,message:`Ad Error: ${n}`,code:t[s.INFO_KEY_ERROR_CODE],module:t[s.INFO_KEY_ERROR_MODULE]}}adEventObject(t){const s=this.currentSlot,i={client:e};if(s&&(i.tag=s.getCustomId()),!t&&s&&(t=s.getCurrentAdInstance()),!t)return i;const n=s.getTimePositionClass(),r="OVERLAY"===n,o=t.getActiveCreativeRendition();i.freewheel={ad:{adId:t.getAdId()}},i.adposition=n.toLowerCase().replace("roll",""),i.id=t.getAdId(),i.linear=r?"nonlinear":"linear",i.creativetype="static",i.viewable=this.player.getViewable(),r||(i.creativetype="VPAID"===o.getCreativeApi()?"vpaid-js":o.getContentType());const a=s.getAdCount();return a>1&&(i.sequence=s.getAdInstances().indexOf(t)+1,i.podcount=a),t.skipoffset&&(i.skipoffset=t.skipoffset),i}allAdEvent(e){const{sdk:s}=this,n=e.subType,r=e.adInstance,o=n===s.EVENT_AD_PAUSE?"paused":t;switch(n){case s.EVENT_AD_IMPRESSION:this.adImpression(e);break;case s.EVENT_AD_IMPRESSION_END:this.setTimeoutAdStart(e);break;case s.EVENT_AD_PAUSE:case s.EVENT_AD_RESUME:null===this.reason&&"VPAID"===r.getActiveCreativeRendition().getCreativeApi()&&(this.reason=i),this.setState(r,o);break;case s.EVENT_AD_COMPLETE:this.adComplete(e);break;case s.EVENT_AD_CLICK:this.adClick(e);break;case s.EVENT_ERROR:this.adError(e);break;case s.EVENT_AD_AUTO_PLAY_BLOCKED:this.pause({reason:"autostart"}),this.currentSlot&&(a=this.currentSlot.play,pe&&pe.OS.iOS&&ge&&(a(),ge=!1),this.instreamProvider.trigger("playAttemptFailed"))}var a}setupSkipButton(e){let t=this.options.config.skipoffset;const s="POSTROLL"===e.slot.getTimePositionClass()?-1:e.slot.getTimePosition(),i=this.adsLoaderManager.tagMap;if(i){const e=i[s];void 0!==(null==e?void 0:e.skipoffset)&&(t=e.skipoffset)}void 0!==t&&this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off(u,this.skipAd,this),e.adInstance.skipoffset=t,this.blockingInstreamPlayer.setupSkipButton(t,this.options,this.utils.noop),this.blockingInstreamPlayer.on(u,this.skipAd,this))}adStarted(e){const t=e.slot.getTimePositionClass();t!==this.sdk.TIME_POSITION_CLASS_OVERLAY&&(this.player.trigger(h,ue(h,this.player,this.sdk,t)),this.blockingInstreamPlayer.on("destroyed",(()=>{this.player.trigger(c,ue(c,this.player,this.sdk,t))})))}adImpression(e){clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),clearTimeout(this.adBlockTimeout);const s=e.adInstance,i=this.adEventObject(s),n="VPAID"===s.getActiveCreativeRendition().getCreativeApi();if(this.utils.removeClass(this.playerContainer,m),this.utils.toggleClass(this.playerContainer,p,n),this.isPreroll(i)&&(this._qoe.tick("adImpression"),i.timeLoading=this._qoe.between("adLoading","adImpression")),this.updateAdPosition(s),this.progressInterval(this.currentSlot),this.setupSkipButton(e),this.setupNonlinearContainer(),this.resize(),this.environment.OS.mobile&&0===s._context._adVolume&&this.player.setMute(this.instreamProvider.isMuted),this.trigger("adImpression",i),n&&this.trigger("adStarted",i),s.getCompanionAdInstances().length){const e=this.utils.extend({},i);e.companions=s.getCompanionAdInstances(),this.trigger("adCompanions",e)}this.setState(e.adInstance,t)}setTimeoutAdStart(){clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),this.timeoutAdStart=setTimeout((()=>{if(this.destroyed())return;const e=this.adEventObject();e.message="Ad Error: Creative timeout",this.trigger(d,e),this.currentSlot.skipCurrentAd()}),this.options.loadVideoTimeout)}setAdBlockTimeout(){this.player.getAdBlock()&&(clearTimeout(this.adBlockTimeout),this.adBlockTimeout=setTimeout((()=>{this.destroyed()||this.adError({id:void 0,client:e,message:"Ad playback blocked by an ad blocker",code:900,adErrorCode:60003})}),this.options.adBlockTimeout))}setVideoState({type:e}){var t;const{sdk:s}=this;if(null!=this&&null!=(t=this.adsLoaderManager)&&t.currentAdContext){const t={idle:s.VIDEO_STATE_STOPPED,play:s.VIDEO_STATE_PLAYING,pause:s.VIDEO_STATE_PAUSED,beforeComplete:s.VIDEO_STATE_COMPLETED};this.adsLoaderManager.currentAdContext.setVideoState(t[e])}}adResume({reason:e}){this.hasResumed||(this.reason=e,this.currentSlot.resume()),this.hasResumed=!1}skipAd(){const e=this.currentSlot;e.getCurrentAdInstance()&&(clearInterval(this.progressIntervalId),this.trigger(u,this.adEventObject()),e.skipCurrentAd())}stopAd(){const e=this.currentSlot;e&&(clearInterval(this.progressIntervalId),this.trigger(u,this.adEventObject()),e.stop())}adComplete(e){clearInterval(this.progressIntervalId),this.trigger("adComplete",this.adEventObject(e.adInstance))}adSlotComplete(e){const t=e.slot;t&&"POSTROLL"===t.getTimePositionClass()?setTimeout((()=>{this.stopBlocking(),this.nonlinearContainerId=null,this.destroy()}),0):(this.stopBlocking(),this.nonlinearContainerId=null)}adClick(e){this.trigger("adClick",this.adEventObject(e.adInstance)),this.pause({reason:"clickthrough"})}adError(e){this.options.debug&&console.error(e);const t=this.adErrorEventObject(e);900===t.code&&(this.timeoutAdStart=setTimeout((()=>this.destroy()),0));const s=e?e.adInstance:null;s&&this.isPreroll(this.adEventObject(s))&&(this._qoe.tick("adError"),t.timeLoading=this._qoe.between("adLoading","adError")),this.trigger(d,t)}updateAdPosition(e){this.instreamProvider&&this.instreamProvider.trigger(n,{position:Math.max(e.getPlayheadTime(),0),duration:e.getDuration()})}prepareToPlayAd(e){if(!this.destroyed())if(this.blockingInstreamPlayer){const t=e?"":this.options.loadingAd;this.blockingInstreamPlayer.setText(t)}else this.startBlocking(e)}playUnscheduledAd(e){const{sdk:t}=this;let s=this.adsLoaderManager.currentAdContext.getSlotByCustomId(e);if(s)return void this._skipAndPlayAd(s);const i=this.unscheduledAdContext=this.adsLoaderManager.adsManager.newContext();this.adsLoaderManager.setContextSettings(i),i.addTemporalSlot(e,t.ADUNIT_MIDROLL,this.player.getPosition()),this.adsLoaderManager.setCustomKeys(i),this.registerEvents(i),i.addEventListener(t.EVENT_ERROR,this.adError),i.addEventListener(t.EVENT_REQUEST_COMPLETE,(()=>{if(s=i.getSlotByCustomId(e),s)return void this._skipAndPlayAd(s);const t=this.adEventObject();t.message="Ad Error: No ads found.",this.trigger(d,t)})),this.adsLoaderManager.setRequestSettings(i,this.player),i.submitRequest()}_skipAndPlayAd(e){this.blockingInstreamPlayer&&this.skipAd(),this.playNextAd([e])}addMobileListeners(){Object.keys(this.mobileEventListeners).forEach((e=>{this.video.addEventListener(e,this.mobileEventListeners[e])}))}removeMobileListeners(){Object.keys(this.mobileEventListeners).forEach((e=>{this.video.removeEventListener(e,this.mobileEventListeners[e])}))}addPlayerListeners(){this.player.on(this.playerEventListeners,this)}removePlayerListeners(){this.player.off(this.playerEventListeners,this)}startBlocking(){var e;this.blockingInstreamPlayer||(!function(e){if(pe=e.getEnvironment(),!pe.OS.iOS||pe.Browser.version.major<10)return;const t=e.getContainer();t.requestFullscreen||t.webkitRequestFullscreen||e.getFullscreen()&&(e.setFullscreen(!1),ge=!0)}(this.player),this._qoe.tick("adLoading"),clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),clearTimeout(this.adBlockTimeout),this.timeoutAdLoad=setTimeout((()=>{if(this.destroyed())return;this.currentSlot&&this.currentSlot.stop();const e=this.adEventObject();e.message="Ad Error: Request timeout",this.trigger(d,e),this.stopBlocking()}),this.options.requestTimeout),this.utils.addClass(this.playerContainer,g),this.blockingInstreamPlayer=this.player.createInstream().init(),this.video=this.instreamProvider.video=this.blockingInstreamPlayer.getMediaElement(),this.video.addEventListener("mousedown",me),this.video.addEventListener("pointerdown",me),null==(e=this.unscheduledAdContext)||e.registerVideoDisplayBase(`${this.playerContainer.id}-jw-wrapper`),this.player.getPip()&&this.player.requestPip(this.video),this.blockingInstreamPlayer.applyProviderListeners(this.instreamProvider),this.environment.OS.mobile&&(this.removeMobileListeners(),this.addMobileListeners()))}stopBlocking(){this.destroyed()||(clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),clearTimeout(this.adBlockTimeout),this.utils.removeClass(this.playerContainer,[p,g,m]),this.environment.OS.mobile&&this.removeMobileListeners(),this.blockingInstreamPlayer&&(this.instreamProvider.off(),this.blockingInstreamPlayer.destroy(),this.blockingInstreamPlayer=null,this.video.removeEventListener("mousedown",me),this.video.removeEventListener("pointerdown",me),this.video=this.instreamProvider.video=null))}setupNonlinearContainer(){if(!this.nonlinearContainerId)return;const e=document.getElementById(this.nonlinearContainerId);this.utils.addClass(e,"jw-freewheel-nonlinear-container"),this.style(e,{top:"auto",height:"100%",width:"100%"})}beforePlay(e){this.reason=null!=e&&e.playReason?e.playReason:s;const t=!this.slots.prerolls.length;this.startBlocking(t),this.utils.addClass(this.playerContainer,m),this.initAdsManagerPromise.then((()=>{this.setAdBlockTimeout(),this.adsLoaderManager.requestAds(this.player)})),this.adsLoadedPromise.then((e=>{!this.destroyed()&&e.success&&this.playNextAd(this.slots.prerolls)})).catch((e=>this.asyncError(e)))}playNextAd(e){if(e.length){const t=this.currentSlot=e.shift();if("OVERLAY"!==t.getTimePositionClass()){const e=!t.getAdCount();this.prepareToPlayAd(e),this.nonlinearContainerId=null}else this.utils.addClass(this.playerContainer,g),this.nonlinearContainerId=`_fw_ad_container_html_${this.currentSlot.getCustomId()}_`;this.setTimeoutAdStart(),t.play(),"MIDROLL"===t.getTimePositionClass()&&this.setVideoState({type:"pause"})}else this.stopBlocking()}beforeComplete(){this.slots.postrolls.length&&this.playNextAd(this.slots.postrolls)}time(e){if(this.slots.midrolls.length){const t=this.getNextMidRollIndex(e.position);if(t>=0){const e=[this.slots.midrolls[t]];this.playNextAd(e)}}}progressInterval(e){if(clearInterval(this.progressIntervalId),!e)return;const t=e.getCurrentAdInstance(),s=e.getAdInstances().indexOf(t)+1,i=t.getDuration(),n=e.getAdCount();let r=-1;const o=this.options.admessage||"",a=this.options.admessagedynamickey,l=this.options.podmessage||"",d=new RegExp("__AD_POD_CURRENT__","g"),h=new RegExp("__AD_POD_LENGTH__","g");this.progressIntervalId=setInterval((()=>{const e=t.getPlayheadTime(),c=i-e;if(r!==c){if(r=c,this.blockingInstreamPlayer){let e,t=o.replace(a,`$1${Math.round(c)}$2`);n>1&&(e=l.replace(d,s),t=`${e.replace(h,n)}  ${t}`),this.blockingInstreamPlayer.setText(t)}if(i>0){const s=this.adEventObject(t);s.position=e,s.duration=i,this.trigger("adTime",s),this.updateAdPosition(t)}}}),250)}getNextMidRollIndex(e){let t=-1;if(this.playedMidrollIndex.length>=this.slots.midrolls.length)return t;for(let s=0;s<this.slots.midrolls.length;s++){if(!(this.slots.midrolls[s].getTimePosition()<=e))break;t=s}return this.playedMidrollIndex.indexOf(t)<0&&t>=0?(this.playedMidrollIndex.push(t),t):-1}setState(e,s){if(this.currentSlot.getTimePositionClass()===this.sdk.TIME_POSITION_CLASS_OVERLAY)return;const i=this.adEventObject(e);if(i.newstate=s,null!==this.reason){i[s===t?"playReason":"pauseReason"]=this.reason,this.reason=null}this.instreamProvider.trigger("state",i)}asyncError(e){this.destroyed()||(e&&this.adError(e),this.timeoutAdStart=setTimeout((()=>this.destroy()),0))}pause({reason:e}){this.currentSlot&&!this.video.paused&&(this.reason=e||s,this.currentSlot.pause())}resume({reason:e}){this.currentSlot&&this.video.paused&&(this.reason=e||s,this.currentSlot.resume(),this.hasResumed=!0)}resize(e,t){var s;const i=document.getElementById(this.nonlinearContainerId);if(i){const e=i.querySelector("iframe"),t=this.player.getSafeRegion(!0);this.style(e,{left:(t.width-e.offsetWidth)/2})}null!=this&&null!=(s=this.adsLoaderManager)&&s.currentAdContext&&e&&t&&this.adsLoaderManager.currentAdContext.resize(e,t)}destroy(){clearInterval(this.progressIntervalId),this.off(),this.destroyed()||(this.removePlayerListeners(),this.currentSlot&&this.currentSlot.stop(),this.blockingInstreamPlayer&&(this.blockingInstreamPlayer.off(null,null,this),this.stopBlocking()),this.destroyAdContext(this.unscheduledAdContext),this.adsLoaderManager&&(this.adsLoaderManager.destroy(),this.destroyAdContext(this.adsLoaderManager.currentAdContext)),clearTimeout(this.timeoutAdLoad),clearTimeout(this.timeoutAdStart),clearTimeout(this.adBlockTimeout),this.nonlinearContainerId=null,this.item=null,this.options=null,this.player.off(null,null,this),this.player=null,this.instreamProvider.off(),this.instreamProvider.setProxy(null),this.instreamProvider=null,this.video=null,this.initAdsManagerPromise=null,this.adsLoadedPromise=null)}destroyAdContext(e){const{sdk:t}=this;e&&(e.removeEventListener(t.EVENT_SLOT_STARTED,this.adStarted),e.removeEventListener(t.EVENT_SLOT_ENDED,this.adSlotComplete),e.removeEventListener(t.EVENT_AD,this.allAdEvent),e.dispose())}destroyed(){return!this.item}isPreroll(e){return"pre"===e.adposition&&(void 0===e.podcount||0===e.sequence)}}!function(e){if(e&&"undefined"!=typeof window){var t=document.createElement("style");t.setAttribute("media","screen"),t.innerHTML=e,document.head.appendChild(t)}}(".jwplayer.jw-flag-ads-freewheel.jw-flag-floating .jw-wrapper,.jwplayer.jw-flag-ads-freewheel.jw-freewheel-before-impression .jw-media video{pointer-events:none}.jwplayer.jw-flag-ads-freewheel.jw-flag-touch.jwplayer.jw-flag-ads-freewheel.jw-state-paused .jw-display-icon-container{display:none}.jwplayer.jw-flag-ads-freewheel.jw-flag-user-inactive.jw-state-playing .jw-freewheel-nonlinear-container{bottom:.5em}.jwplayer.jw-flag-ads-freewheel .jw-freewheel-nonlinear-container{bottom:3.5em;pointer-events:none}.jwplayer.jw-flag-ads-freewheel .jw-freewheel-nonlinear-container iframe{pointer-events:all}.jwplayer.jw-flag-ads-freewheel.jw-flag-time-slider-above .jw-freewheel-nonlinear-container{bottom:66px}"),function(e,t,s){try{(window.jwplayerPluginJsonp||window.jwplayer().registerPlugin)(e,t,s)}catch(e){}}(e,"8.1",class extends y{constructor(t,s){super(t,s,null,e),this.resetSchedule=()=>{this.destroyAdsManager(),function(e){const t=e.getCues();if(Array.isArray(t)&&t.length){const s=t.filter((e=>"ads"!==e.cueType));e.setCues(s)}}(this.player)},this.rulesAllowAdPlayback=e=>{const t=e.getAdRules(),s=0===t.frequency&&1===this.playlistItemEventCount,i=this.playlistItemEventCount>=t.startOn&&(this.playlistItemEventCount-t.startOn)%t.frequency==0;return s||i},this.onAll=(e,t)=>{e===n?this.playlistItemManager.time(t):"beforeComplete"===e&&this.playlistItemManager.beforeComplete()},this.initAdsManager=(e,t)=>{const s=e.item,i=new Y(this.pluginConfig||{},this.player.getConfig(),s);this.resetSchedule(),this.rulesAllowAdPlayback(i)?i.getSchedule()&&(this.playlistItemManager=new fe(s,i,this.player,this.instreamProvider,t,this.sdk||null),this.playlistItemManager.init(),this.playlistItemManager.on("all",((e,t)=>this.player.trigger(e,t))),this.player.once("beforePlay",(e=>this.playlistItemManager.beforePlay(e)),this.playlistItemManager).on("resize",(({width:e,height:t})=>this.playlistItemManager.resize(e,t)),this.playlistItemManager).on("fullscreen",(()=>this.playlistItemManager.resize()),this.playlistItemManager).on("all",this.onAll,this.playlistItemManager)):i.adschedule=null},this.playAd=e=>{e&&this.playlistItemManager&&this.playlistItemManager.playUnscheduledAd(e)},this.stopAd=()=>{this.playlistItemManager&&this.playlistItemManager.stopAd()},this.utils.extend(this,this.player.Events),this.instreamProvider=new ee(this.utils,this.player.Events),this.adManagerURL=this.pluginConfig.freewheel?this.pluginConfig.freewheel.adManagerURL:null,this.playlistItemEventCount=0,this.version=te,J(this.utils,this.adManagerURL).then((()=>{this.sdk=tv.freewheel.SDK;const{sdk:e}=this;this.pluginConfig.debug?e.setLogLevel(e.LOG_LEVEL_DEBUG):e.setLogLevel(e.LOG_LEVEL_QUIET)})).catch(this.utils.noop),this.player.playAd=this.playAd,this.player.on("ready",(()=>{J(this.utils,this.adManagerURL).catch((()=>{this.handleDependencyError("Ad playback blocked by an ad blocker",2e4)})),this.entitlementsPromise.catch((e=>{this.handleDependencyError(`Ad Error: ${e.message}`,60002)}))})).on("playlistItem",(e=>{var t;this.playlistItemEventCount++;const s=e.item.streamtype||(null==(t=e.item.freewheel)?void 0:t.streamtype)||this.pluginConfig.freewheel.streamtype||this.playerConfig.streamtype;this.initAdsManager(e,s)})).on("playlistComplete",(()=>{this.resetSchedule()})).on("cast",(e=>{e.active&&this.resetSchedule()})).on("destroyPlugin",(()=>{this.destroy()})),this.entitlementsPromise=Z(this.utils,this.playerKey,this.pluginConfig),this.entitlementsPromise.catch(this.utils.noop),this.destroy=this.destroyAdsManager}})}();
